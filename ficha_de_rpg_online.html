<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Ficha de RPG</title>
<style>
body{font-family:Arial;background:#1e1e1e;color:#eee;margin:0;padding:0}
header{background:#111;padding:10px;text-align:center;font-size:22px;font-weight:bold}
nav{display:flex;flex-wrap:wrap;background:#222}
nav button{flex:1;padding:10px;background:#222;border:none;color:#fff;cursor:pointer}
nav button:hover{background:#333}
section{display:none;padding:15px}
section.active{display:block}
.card{background:#2a2a2a;padding:10px;margin-bottom:10px;border-radius:6px}
input,textarea{width:100%;background:#111;color:#fff;border:1px solid #444;border-radius:4px;padding:5px}
.attribute{display:grid;grid-template-columns:1fr 80px 120px;gap:5px;align-items:center}
.attribute button{padding:5px}
.bar-container{background:#444;border-radius:6px;overflow:hidden;height:20px;margin-bottom:5px}
.bar{height:100%;width:100%}
.red{background:#c0392b}
.blue{background:#2980b9}
.item{border:1px solid #444;padding:5px;margin:5px 0;border-radius:4px}
.log{background:#111;max-height:200px;overflow:auto;padding:5px;font-size:14px}
</style>
</head>
<body>
<header>Ficha de Personagem</header>
<nav>
<button onclick="showTab('descricao')">Descrição</button>
<button onclick="showTab('atributos')">Atributos</button>
<button onclick="showTab('historia')">História</button>
<button onclick="showTab('combate')">Combate</button>
<button onclick="showTab('itens')">Itens</button>
<button onclick="showTab('habilidades')">Habilidades</button>
<button onclick="showTab('dados')">Dados</button>
<button onclick="showTab('historico')">Histórico</button>
</nav>

<section id="descricao" class="active">
<div class="card">
<label>Imagem da Ficha</label>
<input type="text" placeholder="URL da imagem ou gif">
</div>
<div class="card">
<label>Nome</label><input>
<label>Raça / Espécie</label><input>
<label>Classe / Profissão</label><input>
<label>Idade</label><input>
<label>Sexo</label><input>
<label>Altura</label><input>
<label>Afiliamento Moral</label><input>
</div>
<div class="card">
<button onclick="gerarLink()">Gerar link da ficha</button>
<input id="linkFicha" readonly>
</div>
<div class="card">
<button onclick="exportarJSON()">Exportar ficha (JSON)</button>
<input type="file" id="importJSON" accept="application/json" onchange="importarJSON(event)">
</div>
</section>

<section id="atributos"></section>

<section id="historia">
<textarea rows="10" placeholder="História do personagem"></textarea>
</section>

<section id="combate">
<div class="card">
<label>Vida (PV)</label>
<input type="number" id="pvAtual" value="100"> / <input type="number" id="pvMax" value="100">
<div class="bar-container"><div id="pvBar" class="bar red"></div></div>
<label>P.T</label>
<input type="number" id="ptAtual" value="5"> / <input type="number" id="ptMax" value="5">
<div class="bar-container"><div id="ptBar" class="bar blue"></div></div>
</div>
</section>

<section id="itens">
<div class="card">
<input id="itemNome" placeholder="Nome do item">
<textarea id="itemDesc" placeholder="Descrição"></textarea>
<input id="itemImg" placeholder="URL imagem/gif">
<button onclick="addItem('itensLista','itemNome','itemDesc','itemImg')">Adicionar Item</button>
</div>
<div id="itensLista"></div>
</section>

<section id="habilidades">
<div class="card">
<input id="habNome" placeholder="Nome da habilidade">
<textarea id="habDesc" placeholder="Descrição"></textarea>
<input id="habImg" placeholder="URL imagem/gif">
<button onclick="addItem('habLista','habNome','habDesc','habImg')">Adicionar Habilidade</button>
</div>
<div id="habLista"></div>
</section>

<section id="dados">
<div class="card">
<label>Quantidade</label><input id="qtd" type="number" value="1">
<label>Faces</label><input id="faces" type="number" value="20">
<label>Modificador</label><input id="mod" type="number" value="0">
<button onclick="rolarCustom()">Rolar</button>
<div id="resultado"></div>
</div>
</section>

<section id="historico">
<div class="log" id="log"></div>
</section>

<script>
const atributos=[
['Força','d100'],['Defesa','d100'],['Percepção','d20'],['Inteligência','d20'],['Furtividade','d20'],['Intimidação','d20'],['Carisma','d20'],['Agilidade','d20'],['Intuição','d20'],['Poder Mágico','d100'],['Vontade','d100'],['Precisão','d20']
];
const tabela=[
{p:-1,b:-2},{p:0,b:-1},{p:1,b:0},{p:3,b:1},{p:6,b:2},{p:10,b:3},{p:15,b:4},{p:21,b:5},{p:28,b:6}
];
const attDiv=document.getElementById('atributos');
atributos.forEach(a=>{
let c=document.createElement('div');c.className='card attribute';
c.innerHTML=`<b>${a[0]}</b><input type='number' min='-1' max='35' value='1'><button>Rolar</button><div></div>`;
let input=c.children[1],btn=c.children[2],res=c.children[3];
btn.onclick=()=>{
let pts=parseInt(input.value)||0;let bonus=0;
for(let t of tabela){if(pts>=t.p)bonus=t.b}
let faces=a[1]=='d100'?100:20;let conv=a[1]=='d100'?bonus*5:bonus;
let roll=Math.floor(Math.random()*faces)+1;
let total=roll+conv;
res.textContent=`${roll} ${conv>=0?'+':''}${conv} = ${total}`;
log.innerHTML+=`<div>${a[0]}: ${res.textContent}</div>`;
};
attDiv.appendChild(c);
});

function showTab(id){document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active')}
function rolarCustom(){let q=+qtd.value,f=+faces.value,m=+mod.value;let t=m,r=[];for(let i=0;i<q;i++){let d=Math.floor(Math.random()*f)+1;r.push(d);t+=d;}let txt=`${q}d${f} [${r.join(', ')}] ${m>=0?'+':''}${m} = ${t}`;resultado.textContent=txt;log.innerHTML+=`<div>${txt}</div>`}
function addItem(lista,n,d,i){let l=document.getElementById(lista);let div=document.createElement('div');div.className='item';div.innerHTML=`<b>${document.getElementById(n).value}</b><br>${document.getElementById(d).value}<br><img src='${document.getElementById(i).value}' width='80'><br><button onclick='this.parentElement.remove()'>Remover</button>`;l.appendChild(div)}
function gerarLink(){linkFicha.value=location.href+'#'+Math.random().toString(36).substring(2)}
function updateBars(){pvBar.style.width=(pvAtual.value/pvMax.value*100)+'%';ptBar.style.width=(ptAtual.value/ptMax.value*100)+'%'}
setInterval(updateBars,200);

function exportarJSON(){
const data={};
data.inputs=[...document.querySelectorAll('input,textarea')].map(i=>({id:i.id,value:i.value}));
data.itens=itensLista.innerHTML;
data.habilidades=habLista.innerHTML;
const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='ficha.json';a.click();
}

function importarJSON(e){
const file=e.target.files[0];if(!file)return;
const r=new FileReader();
r.onload=()=>{const d=JSON.parse(r.result);
d.inputs.forEach(i=>{const el=document.getElementById(i.id);if(el)el.value=i.value});
itensLista.innerHTML=d.itens||'';
habLista.innerHTML=d.habilidades||'';
};
r.readAsText(file);
}
</script>
</body>
</html>
