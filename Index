<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Ficha de RPG</title>

<style>
body{margin:0;font-family:Arial;background:#1b1026;color:#f2e9ff}
header{background:#2a1740;padding:12px;text-align:center;font-size:22px}
nav{display:flex;flex-wrap:wrap;background:#3a1f5c}
nav button{flex:1 1 50%;padding:12px;background:#3a1f5c;border:none;color:#fff;font-size:16px;cursor:pointer}
nav button:hover{background:#4a2a73}
section{display:none;padding:12px}
section.active{display:block}
.card{background:#2f1b4a;padding:10px;margin-bottom:10px;border-radius:10px}
input,textarea{width:100%;background:#2a1740;color:#fff;border:1px solid #5a3a85;border-radius:6px;padding:8px;font-size:16px}
.attribute{display:grid;grid-template-columns:1fr 80px 90px;gap:6px;align-items:center}
.bar-container{background:#5a3a85;border-radius:10px;overflow:hidden;height:18px}
.bar{height:100%}
.red{background:#c0392b}
.blue{background:#2980b9}
.item{border:1px solid #5a3a85;padding:6px;margin:6px 0;border-radius:6px}
.log{background:#2a1740;max-height:200px;overflow:auto;padding:6px}
</style>
</head>

<body>

<header>Ficha de Personagem</header>

<nav>
<button onclick="showTab('descricao')">Descrição</button>
<button onclick="showTab('personagens')">Personagens</button>
<button onclick="showTab('atributos')">Atributos</button>
<button onclick="showTab('historia')">História</button>
<button onclick="showTab('combate')">Combate</button>
<button onclick="showTab('itens')">Itens</button>
<button onclick="showTab('habilidades')">Habilidades</button>
<button onclick="showTab('dados')">Dados</button>
<button onclick="showTab('historico')">Histórico</button>
</nav>

<section id="descricao" class="active">
<div class="card">
<button onclick="salvarPersonagem()">Salvar Personagem</button>
</div>

<div class="card">
<label>Imagem</label>
<input id="imgFicha">
<label>Nome</label><input id="nome">
<label>Raça</label><input id="raca">
<label>Classe</label><input id="classe">
<label>Idade</label><input id="idade">
<label>Sexo</label><input id="sexo">
<label>Altura</label><input id="altura">
<label>Afiliamento Moral</label><input id="moral">
</div>
</section>

<section id="personagens">
<div class="card">
<b>Personagens Salvos</b>
<div id="listaPersonagens"></div>
</div>
</section>

<section id="atributos"></section>

<section id="historia">
<textarea id="historiaTxt" rows="10" placeholder="História do personagem"></textarea>
</section>

<section id="combate">
<div class="card">
<label>Vida</label>
<input id="pvAtual" type="number" value="100">
<input id="pvMax" type="number" value="100">
<div class="bar-container"><div id="pvBar" class="bar red"></div></div>

<label>P.T</label>
<input id="ptAtual" type="number" value="5">
<input id="ptMax" type="number" value="5">
<div class="bar-container"><div id="ptBar" class="bar blue"></div></div>
</div>
</section>

<section id="itens">
<div class="card">
<input id="itemNome" placeholder="Nome do item">
<textarea id="itemDesc" placeholder="Descrição"></textarea>
<input id="itemImg" placeholder="Imagem">
<button onclick="addItem('itensLista','itemNome','itemDesc','itemImg')">Adicionar</button>
</div>
<div id="itensLista"></div>
</section>

<section id="habilidades">
<div class="card">
<input id="habNome" placeholder="Nome da habilidade">
<textarea id="habDesc" placeholder="Descrição"></textarea>
<input id="habImg" placeholder="Imagem">
<button onclick="addItem('habLista','habNome','habDesc','habImg')">Adicionar</button>
</div>
<div id="habLista"></div>
</section>

<section id="dados">
<div class="card">
<input id="qtd" type="number" value="1">
<input id="faces" type="number" value="20">
<input id="mod" type="number" value="0">
<button onclick="rolarCustom()">Rolar</button>
<div id="resultado"></div>
</div>
</section>

<section id="historico">
<div id="log" class="log"></div>
</section>

<script>
/* --------- Navegação --------- */
function showTab(id){
 document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
}

/* --------- Atributos --------- */
const atributos=[
['Força',100],['Defesa',100],['Percepção',20],['Inteligência',20],
['Furtividade',20],['Intimidação',20],['Carisma',20],
['Agilidade',20],['Intuição',20],['Poder Mágico',100],
['Vontade',100],['Precisão',20]
];

const tabela=[
{p:-1,b:-2},{p:0,b:-1},{p:1,b:0},{p:3,b:1},{p:6,b:2},
{p:10,b:3},{p:15,b:4},{p:21,b:5},{p:28,b:6}
];

const attDiv=document.getElementById('atributos');

atributos.forEach(att=>{
 const card=document.createElement('div');
 card.className='card attribute';
 card.innerHTML=`<b>${att[0]}</b>
 <input type="number" min="-1" max="35" value="1">
 <button>Rolar</button><div></div>`;

 const input=card.children[1];
 const res=card.children[3];

 card.children[2].onclick=()=>{
  let pts=parseInt(input.value)||0;
  let bonus=0;
  tabela.forEach(t=>{if(pts>=t.p)bonus=t.b});
  let conv=att[1]===100?bonus*5:bonus;
  let roll=Math.floor(Math.random()*att[1])+1;
  let total=roll+conv;
  res.textContent=`${roll} ${conv>=0?'+':''}${conv} = ${total}`;
  log.innerHTML+=`<div>${att[0]}: ${res.textContent}</div>`;
 };

 attDiv.appendChild(card);
});

/* --------- Dados --------- */
function rolarCustom(){
 let q=+qtd.value,f=+faces.value,m=+mod.value;
 let total=m,lista=[];
 for(let i=0;i<q;i++){let d=Math.floor(Math.random()*f)+1;lista.push(d);total+=d;}
 let txt=`${q}d${f} [${lista.join(', ')}] ${m>=0?'+':''}${m} = ${total}`;
 resultado.textContent=txt;
 log.innerHTML+=`<div>${txt}</div>`;
}

/* --------- Itens / Habilidades --------- */
function addItem(lista,n,d,i){
 const div=document.createElement('div');
 div.className='item';
 div.innerHTML=`<b>${document.getElementById(n).value}</b><br>
 ${document.getElementById(d).value}<br>
 <img src="${document.getElementById(i).value}" width="80"><br>
 <button onclick="this.parentElement.remove()">Remover</button>`;
 document.getElementById(lista).appendChild(div);
}

/* --------- Barras --------- */
function updateBars(){
 pvBar.style.width=(pvAtual.value/pvMax.value*100)+'%';
 ptBar.style.width=(ptAtual.value/ptMax.value*100)+'%';
}
setInterval(updateBars,200);

/* --------- LocalStorage --------- */
function salvarLocal(){
 const data={
  inputs:[...document.querySelectorAll('input,textarea')].map(i=>({id:i.id,value:i.value})),
  itens:itensLista.innerHTML,
  hab:habLista.innerHTML
 };
 localStorage.setItem('fichaRPG',JSON.stringify(data));
}

function carregarLocal(){
 const raw=localStorage.getItem('fichaRPG');
 if(!raw)return;
 const d=JSON.parse(raw);
 d.inputs.forEach(o=>{const el=document.getElementById(o.id);if(el)el.value=o.value});
 itensLista.innerHTML=d.itens||'';
 habLista.innerHTML=d.hab||'';
}

/* --------- Personagens --------- */
function salvarPersonagem(){
 const lista=JSON.parse(localStorage.getItem('personagensRPG')||'[]');
 lista.push(JSON.parse(localStorage.getItem('fichaRPG')));
 localStorage.setItem('personagensRPG',JSON.stringify(lista));
 carregarPersonagens();
 alert('Personagem salvo!');
}

function carregarPersonagens(){
 const div=document.getElementById('listaPersonagens');
 div.innerHTML='';
 const lista=JSON.parse(localStorage.getItem('personagensRPG')||'[]');
 lista.forEach((p,i)=>{
  const d=document.createElement('div');
  d.className='item';
  d.innerHTML=`Personagem ${i+1}<br>
  <button onclick="carregarPersonagem(${i})">Carregar</button>`;
  div.appendChild(d);
 });
}

function carregarPersonagem(i){
 const lista=JSON.parse(localStorage.getItem('personagensRPG')||'[]');
 localStorage.setItem('fichaRPG',JSON.stringify(lista[i]));
 carregarLocal();
 showTab('descricao');
}

setInterval(salvarLocal,2000);
window.onload=()=>{
 carregarLocal();
 carregarPersonagens();
};
</script>
</body>
</html>
